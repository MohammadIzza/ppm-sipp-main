<html lang="en">
    <!--begin::Head-->
    <head>
        <!-- Google Tag Manager -->
        <!--<script>(function(w, d, s, l, i){w[l] = w[l] || []; w[l].push({'gtm.start': new Date().getTime(), event:'gtm.js'}); var f = d.getElementsByTagName(s)[0], j = d.createElement(s), dl = l != 'dataLayer'?'&amp;l=' + l:''; j.async = true; j.src = 'https://www.googletagmanager.com/gtm.js?id=' + i + dl; f.parentNode.insertBefore(j, f); })(window, document, 'script', 'dataLayer', 'GTM-5FS8GGP');</script>-->
        <!-- End Google Tag Manager -->
        <meta charset="utf-8" />
        <title>PPM-Apps FSM</title>
        <meta name="description" content="Updates and statistics" />
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
        
        <!--begin::Fonts-->
        <link href=<?php echo base_url() . "dist/assets/css/font.css" ?> rel="stylesheet" type="text/css" />
        <link href=<?php echo base_url() . "dist/assets/plugins/custom/datatables/datatables.bundle.css" ?> rel="stylesheet" type="text/css" />
        <!--end::Fonts-->
        <!--begin::Page Vendors Styles(used by this page)-->
        <link href=<?php echo base_url() . "dist/assets/css/pages/wizard/wizard-3.css" ?> rel="stylesheet" type="text/css" />
        <!--end::Page Vendors Styles-->
        <!--begin::Global Theme Styles(used by all pages)-->
        <link href=<?php echo base_url() . "dist/assets/plugins/global/plugins.bundle.css?v=7.2.8" ?> rel="stylesheet" type="text/css" />
        <link href=<?php echo base_url() . "dist/assets/plugins/custom/prismjs/prismjs.bundle.css?v=7.2.8" ?> rel="stylesheet" type="text/css" />
        <link href=<?php echo base_url() . "dist/assets/css/style.bundle.css?v=7.2.8" ?> rel="stylesheet" type="text/css" />
        <!--end::Global Theme Styles-->
        <!--begin::Layout Themes(used by all pages)-->
        <!--end::Layout Themes-->
        <link rel="shortcut icon" href=<?php echo base_url() . "images/favicon-undip.ico" ?> />
        <!-- Hotjar Tracking Code for keenthemes.com -->
        <!--<script>(function(h, o, t, j, a, r){ h.hj = h.hj || function(){(h.hj.q = h.hj.q || []).push(arguments)}; h._hjSettings = {hjid:1070954, hjsv:6}; a = o.getElementsByTagName('head')[0]; r = o.createElement('script'); r.async = 1; r.src = t + h._hjSettings.hjid + j + h._hjSettings.hjsv; a.appendChild(r); })(window, document, 'https://static.hotjar.com/c/hotjar-', '.js?sv=');</script>-->
        <style>
        </style>
    </head>
    <!--end::Head-->
    <!--begin::Body-->
    <body id="kt_body" style="background-image: url(<?php echo base_url() . 'dist/assets/media/bg/bg-10.jpg' ?>)" class="page-loading-enabled page-loading quick-panel-right demo-panel-right offcanvas-right header-static subheader-enabled aside-enabled aside-static page-loading">
        <!-- Google Tag Manager (noscript) -->
        <!--        <noscript>
                <iframe src="https://www.googletagmanager.com/ns.html?id=GTM-5FS8GGP" height="0" width="0" style="display:none;visibility:hidden"></iframe>
                </noscript>-->
        <!-- End Google Tag Manager (noscript) -->
        <?php include 'loader.php'; ?>
        <!--begin::Main-->
        <!--begin::Header Mobile-->
        <div id="kt_header_mobile" class="header-mobile">
            <!--begin::Logo-->
            <a href="index.html">
                <img alt="Logo" src=<?php echo base_url() . "images/logo-fsm.png" ?> class="logo-default max-h-30px" />
            </a>
            <!--end::Logo-->
            <!--begin::Toolbar-->
            <div class="d-flex align-items-center">
                <button class="btn p-0 burger-icon burger-icon-left" id="kt_aside_mobile_toggle">
                    <span></span>
                </button>
                <button class="btn p-0 burger-icon burger-icon-left ml-4" id="kt_header_mobile_toggle">
                    <span></span>
                </button>
                <button class="btn btn-icon btn-hover-transparent-white p-0 ml-3" id="kt_header_mobile_topbar_toggle">
                    <span class="svg-icon svg-icon-xl">
                        <!--begin::Svg Icon | path:assets/media/svg/icons/General/User.svg-->
                        <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="24px" height="24px" viewBox="0 0 24 24" version="1.1">
                        <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                        <polygon points="0 0 24 0 24 24 0 24" />
                        <path d="M12,11 C9.790861,11 8,9.209139 8,7 C8,4.790861 9.790861,3 12,3 C14.209139,3 16,4.790861 16,7 C16,9.209139 14.209139,11 12,11 Z" fill="#000000" fill-rule="nonzero" opacity="0.3" />
                        <path d="M3.00065168,20.1992055 C3.38825852,15.4265159 7.26191235,13 11.9833413,13 C16.7712164,13 20.7048837,15.2931929 20.9979143,20.2 C21.0095879,20.3954741 20.9979143,21 20.2466999,21 C16.541124,21 11.0347247,21 3.72750223,21 C3.47671215,21 2.97953825,20.45918 3.00065168,20.1992055 Z" fill="#000000" fill-rule="nonzero" />
                        </g>
                        </svg>
                        <!--end::Svg Icon-->
                    </span>
                </button>
            </div>
            <!--end::Toolbar-->
        </div>
        <!--end::Header Mobile-->
        <div class="d-flex flex-column flex-root">
            <!--begin::Page-->
            <div class="d-flex flex-row flex-column-fluid page">
                <!--begin::Wrapper-->
                <div class="d-flex flex-column flex-row-fluid wrapper" id="kt_wrapper">
                    <?php include('v_header.php'); ?>
                    <!--begin::Content-->
                    <div class="content d-flex flex-column flex-column-fluid" id="kt_content">
                        <!--begin::Subheader-->
                        <div class="subheader py-2 py-lg-12 subheader-transparent" id="kt_subheader">
                            <div class="container-fluid d-flex align-items-center justify-content-between flex-wrap flex-sm-nowrap">
                                <!--begin::Info-->
                                <div class="d-flex align-items-center flex-wrap mr-1">
                                    <!--begin::Heading-->
                                    <div class="d-flex flex-column">
                                        <!--begin::Title-->
                                        <h2 class="text-white font-weight-bold my-2 mr-5">Penelitian & Pengabdian</h2>
                                        <!--end::Title-->
                                        <!--begin::Breadcrumb-->
                                        <div class="d-flex align-items-center font-weight-bold my-2">
                                            <!--begin::Item-->
                                            <a href="#" class="opacity-75 hover-opacity-100">
                                                <i class="flaticon2-shelter text-white icon-1x"></i>
                                            </a>
                                            <!--end::Item-->
                                            <!--begin::Item-->
                                            <span class="label label-dot label-sm bg-white opacity-75 mx-3"></span>
                                            <a href="<?php echo base_url() . "index.php/c_usulan"; ?>" class="text-white text-hover-white opacity-75 hover-opacity-100">Pengajuan Proposal</a>
                                            <!--end::Item-->
                                            <!--begin::Item-->
<!--                                            <span class="label label-dot label-sm bg-white opacity-75 mx-3"></span>
                                            <a href="" class="text-white text-hover-white opacity-75 hover-opacity-100">Latest Updated</a>-->
                                            <!--end::Item-->
                                        </div>
                                        <!--end::Breadcrumb-->
                                    </div>
                                    <!--end::Heading-->
                                </div>
                                <!--end::Info-->
                                <!--begin::Toolbar-->
                                <?php include 'v_toolbar_breadcrumb.php'; ?>
                                <!--end::Toolbar-->
                            </div>
                        </div>
                        <!--end::Subheader-->

                        <!--begin::Entry-->
                        <div class="d-flex flex-column-fluid">
                            <!--begin::Container-->
                            <div class="container-fluid">
                                <div class="d-lg-flex flex-row-fluid">
                                    <?php include 'v_asidemenu.php'; ?>
                                    <div class="content-wrapper flex-row-fluid">
                                        <!--begin::Dashboard-->
                                        <!--begin::Row-->
                                        <div class="row">
                                            <div class="col-lg-12">
                                                <!--begin::Card-->
                                                <div class="card card-custom">
                                                    <div class="card-header flex-wrap border-0 pt-6 pb-0">
                                                        <div class="card-title">
                                                            <h3 class="card-label">Penelitian dan Pengabdian
                                                                <span class="d-block text-muted pt-2 font-size-sm">Daftar Usulan Penelitian dan Pengabdian Saya</span></h3>
                                                        </div>
                                                        <div class="card-toolbar">
                                                            <div class="dropdown dropdown-inline mr-2">
                                                                <?php 
                                                                $status="off";
                                                                if($periode!=null){
                                                                    date_default_timezone_set('Asia/Jakarta');
                                                                    $now = time();
                                                                    $date_start = $periode[0]->start." 00:00:00"; #could be (almost) any string date
                                                                    $date_end = $periode[0]->end." 23:59:59"; #could be (almost) any string date
                                                                    if (strtotime($date_start) < $now && $now < strtotime($date_end)) { 
                                                                        $status="on";
                                                                    } 
                                                                }?>
                                                                <!--begin::Button-->
                                                                <a href="javascript:;" class="btn btn-primary font-weight-bolder usulanbaru <?php if($status=="off"){echo "disabled";} ?>" data-container="body" data-toggle="popover" data-placement="bottom" data-content="Pengajuan Proposal tersedia sampai tanggal <?php echo $dateline; ?> pukul 23:59">
                                                                    <span class="svg-icon svg-icon-md"><!--begin::Svg Icon | path:C:\wamp64\www\keenthemes\legacy\metronic\theme\html\demo2\dist/../src/media/svg/icons\Code\Plus.svg--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="24px" height="24px" viewBox="0 0 24 24" version="1.1">
                                                                        <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                                                                        <rect x="0" y="0" width="24" height="24"/>
                                                                        <circle fill="#000000" opacity="0.3" cx="12" cy="12" r="10"/>
                                                                        <path d="M11,11 L11,7 C11,6.44771525 11.4477153,6 12,6 C12.5522847,6 13,6.44771525 13,7 L13,11 L17,11 C17.5522847,11 18,11.4477153 18,12 C18,12.5522847 17.5522847,13 17,13 L13,13 L13,17 C13,17.5522847 12.5522847,18 12,18 C11.4477153,18 11,17.5522847 11,17 L11,13 L7,13 C6.44771525,13 6,12.5522847 6,12 C6,11.4477153 6.44771525,11 7,11 L11,11 Z" fill="#000000"/>
                                                                        </g>
                                                                        </svg><!--end::Svg Icon--></span>
                                                                    Ajukan Proposal</a>
                                                                <!--end::Button-->
                                                            </div>
                                                            <!--begin::Dropdown-->
<!--                                                            <div class="dropdown dropdown-inline mr-2">
                                                                <button type="button" class="btn btn-light-primary font-weight-bolder dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                                                    <span class="svg-icon svg-icon-md">
                                                                        begin::Svg Icon | path:assets/media/svg/icons/Design/PenAndRuller.svg
                                                                        <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="24px" height="24px" viewBox="0 0 24 24" version="1.1">
                                                                        <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                                                                        <rect x="0" y="0" width="24" height="24" />
                                                                        <path d="M3,16 L5,16 C5.55228475,16 6,15.5522847 6,15 C6,14.4477153 5.55228475,14 5,14 L3,14 L3,12 L5,12 C5.55228475,12 6,11.5522847 6,11 C6,10.4477153 5.55228475,10 5,10 L3,10 L3,8 L5,8 C5.55228475,8 6,7.55228475 6,7 C6,6.44771525 5.55228475,6 5,6 L3,6 L3,4 C3,3.44771525 3.44771525,3 4,3 L10,3 C10.5522847,3 11,3.44771525 11,4 L11,19 C11,19.5522847 10.5522847,20 10,20 L4,20 C3.44771525,20 3,19.5522847 3,19 L3,16 Z" fill="#000000" opacity="0.3" />
                                                                        <path d="M16,3 L19,3 C20.1045695,3 21,3.8954305 21,5 L21,15.2485298 C21,15.7329761 20.8241635,16.200956 20.5051534,16.565539 L17.8762883,19.5699562 C17.6944473,19.7777745 17.378566,19.7988332 17.1707477,19.6169922 C17.1540423,19.602375 17.1383289,19.5866616 17.1237117,19.5699562 L14.4948466,16.565539 C14.1758365,16.200956 14,15.7329761 14,15.2485298 L14,5 C14,3.8954305 14.8954305,3 16,3 Z" fill="#000000" />
                                                                        </g>
                                                                        </svg>
                                                                        end::Svg Icon
                                                                    </span>Export</button>
                                                                begin::Dropdown Menu
                                                                <div class="dropdown-menu dropdown-menu-sm dropdown-menu-right">
                                                                    begin::Navigation
                                                                    <ul class="navi flex-column navi-hover py-2">
                                                                        <li class="navi-header font-weight-bolder text-uppercase font-size-sm text-primary pb-2">Pilih Export ke:</li>
                                                                        <li class="navi-item">
                                                                            <a href="#" class="navi-link">
                                                                                <span class="navi-icon">
                                                                                    <i class="la la-print"></i>
                                                                                </span>
                                                                                <span class="navi-text">Print</span>
                                                                            </a>
                                                                        </li>
                                                                        <li class="navi-item">
                                                                            <a href="#" class="navi-link">
                                                                                <span class="navi-icon">
                                                                                    <i class="la la-copy"></i>
                                                                                </span>
                                                                                <span class="navi-text">Copy</span>
                                                                            </a>
                                                                        </li>
                                                                        <li class="navi-item">
                                                                            <a href="#" class="navi-link">
                                                                                <span class="navi-icon">
                                                                                    <i class="la la-file-excel-o"></i>
                                                                                </span>
                                                                                <span class="navi-text">Excel</span>
                                                                            </a>
                                                                        </li>
                                                                        <li class="navi-item">
                                                                            <a href="#" class="navi-link">
                                                                                <span class="navi-icon">
                                                                                    <i class="la la-file-text-o"></i>
                                                                                </span>
                                                                                <span class="navi-text">CSV</span>
                                                                            </a>
                                                                        </li>
                                                                        <li class="navi-item">
                                                                            <a href="#" class="navi-link">
                                                                                <span class="navi-icon">
                                                                                    <i class="la la-file-pdf-o"></i>
                                                                                </span>
                                                                                <span class="navi-text">PDF</span>
                                                                            </a>
                                                                        </li>
                                                                    </ul>
                                                                    end::Navigation
                                                                </div>
                                                                end::Dropdown Menu
                                                            </div>-->
                                                            <!--end::Dropdown-->
                                                        </div>
                                                    </div>
                                                    <div class="card-body">
                                                        <!--begin: Search Form-->
                                                        <!--begin::Search Form-->
                                                        <div class="mb-7">
                                                            <div class="row align-items-center">
                                                                <div class="col-lg-12 col-xl-12">
                                                                    <div class="row align-items-center">
                                                                        <div class="col-md-4 my-2 my-md-0">
                                                                            <div class="d-flex align-items-center">
                                                                                <label class="mr-3 mb-0 d-none d-md-block">Skema:</label>
                                                                                <select class="form-control" id="kt_datatable_search_skema">
                                                                                    <option value="">Semua Skema</option>
                                                                                    <?php foreach($skema as $data): ?>
                                                                                        <option value="<?php echo $data->idskema; ?>" <?php if(isset($_SESSION['skema'])&& $_SESSION['skema']==$data->idskema){echo "selected"; }?>><?php echo $data->namaskema; ?></option>
                                                                                    <?php endforeach; ?>
                                                                                </select>
                                                                            </div>
                                                                        </div>
                                                                        <div class="col-md-3 my-2 my-md-0">
                                                                            <div class="d-flex align-items-center">
                                                                                <label class="mr-3 mb-0 d-none d-md-block">Status:</label>
                                                                                <select class="form-control" id="kt_datatable_search_status">
                                                                                    <option value="">Semua Status</option>
                                                                                    <option value="1" <?php if(isset($_SESSION['status'])&& $_SESSION['status']== 1){echo "selected"; }?>>Baru</option>
                                                                                    <option value="2" <?php if(isset($_SESSION['status'])&& $_SESSION['status']== 2){echo "selected"; }?>>Final</option>
                                                                                    <option value="3" <?php if(isset($_SESSION['status'])&& $_SESSION['status']== 3){echo "selected"; }?>>Didanai</option>
                                                                                    <option value="4" <?php if(isset($_SESSION['status'])&& $_SESSION['status']== 4){echo "selected"; }?>>Ditolak</option>
                                                                                </select>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>
<!--                                                                <div class="col-lg-3 col-xl-4 mt-5 mt-lg-0">
                                                                    <a href="#" class="btn btn-light-primary px-6 font-weight-bold">Search</a>
                                                                </div>-->
                                                            </div>
                                                        </div>
                                                        <!--end::Search Form-->
                                                        <!--end: Search Form-->
                                                        <!--begin: Datatable-->
                                                        <table class="table table-bordered table-hover table-checkable" id="kt_datatable" style="margin-top: 13px !important">
                                                        <!--<table class="datatable datatable-bordered datatable-head-custom" id="kt_datatable">-->
                                                            <thead>
                                                                <tr>
                                                                    <th title="Field #1">No</th>
                                                                    <th title="Field #2">Judul</th>
                                                                    <th title="Field #3">Peneliti</th>
                                                                    <th title="Field #4">Dana</th>
                                                                    <th title="Field #5">Skema</th>
                                                                    <th title="Field #6">Status</th>
                                                                    <th title="Field #7">Proposal</th>
                                                                    <th title="Field #7">Aksi</th>
                                                                </tr>
                                                            </thead>
                                                            <tbody>
                                                                <?php if($ppm != null){
                                                                        $i=1;
                                                                        foreach($ppm as $data):
                                                                ?>
                                                                <tr>
                                                                    <td  width="5%"><?php echo $i++; ?></td>
                                                                    <td  width="25%"><?php echo $data->judul; ?></td>
                                                                    <td width="20%">
                                                                        <?php 
                                                                        echo "<ol style='padding-left: 15px'>";
                                                                        echo "<li title='Ketua Peneliti'>".$data->gelardepan." ".$data->namalengkap.", ".$data->gelarblkg."</li>"; 
                                                                        $query = $this->db->query("SELECT * from usulananggota, peneliti where usulananggota.nipnim=peneliti.nipnim and idusulan='$data->idusulan' and posisi='Anggota'");
                                                                        if ($query->num_rows() > 0) {
                                                                            foreach ($query->result() as $row) { 
                                                                                echo "<li title='Anggota Peneliti Undip'>".$row->gelardepan." ".$row->namalengkap.", ".$row->gelarblkg."</li>";
                                                                             }                                                                             
                                                                        } 
                                                                        $query_l = $this->db->query("SELECT * from usulananggotaluar where idusulan='$data->idusulan'");
                                                                        if ($query_l->num_rows() > 0) {
                                                                            foreach ($query_l->result() as $rows) { 
                                                                                echo "<li title='Peneliti Luar Undip'>".$rows->gelardepan." ".$rows->namalengkap.", ".$rows->gelarblkg."</li>";
                                                                             }                                                                             
                                                                        }
                                                                        echo "</ol>";
                                                                        ?>
                                                                    </td>
                                                                    <td  width="15%"><?php echo "Rp " . number_format($data->dana,2,',','.'); ?></td>
                                                                    <!--<td>2016-11-28</td>-->
                                                                    <td width="15%"><?php echo $data->idskema; ?></td>
                                                                    <td width="5%">
                                                                        <?php if($data->statususulan=="Baru"){
                                                                            echo "1";
                                                                        }else if($data->statususulan=="Final"){
                                                                            echo "2";
                                                                        }else if($data->statususulan=="Didanai"){
                                                                            echo "3";
                                                                        }else if($data->statususulan=="Tidak Didanai"){
                                                                            echo "4";
                                                                        } ?>
                                                                    </td>
                                                                    <td  width="5%" class="text-center">
                                                                        <?php 
                                                                        $query = $this->db->query("SELECT * from usulanfile where idusulan='$data->idusulan' and idjenis in(select idjenis from jenisfile where namafile='Proposal')");
                                                                        if ($query->num_rows() > 0) {
                                                                            foreach ($query->result() as $row) { ?>
                                                                                    <a href="<?php echo base_url().$row->fileloc; ?>" target="_blank" title="Klik untuk melihat dokumen">
                                                                                        <img alt="" class="max-h-55px" src="<?php echo base_url() . 'dist/assets/media/svg/files/pdf.svg'?>"/>
                                                                                    </a>
                                                                                <?php   
                                                                             }
                                                                        }else{ ?>
                                                                        <i class="fa la-file-pdf icon-4x" title="Proposal belum diunggah"></i>
                                                                        <?php } ?>
                                                                        
                                                                    </td>
                                                                    <td width="10%" class="text-center" nowrap="nowrap">
                                                                        <?php 
                                                                        if($status !="off"){
                                                                            if($data->statususulan=="Baru" or $data->statususulan=="Final"){ ?>
                                                                                <!--begin::Button-->
                                                                                <a href="<?php echo base_url('index.php/c_usulan/editloadingpage/'.$data->idusulan) ?>" class="btn btn-sm btn-warning btn-clean btn-icon" title="Perbarui Usulan" data-toggle="tooltip"><i class="la la-edit"></i></a>
                                                                                <a href="javascript:;" class="btn btn-sm btn-danger btn-clean btn-icon item_hapus" title="Hapus Usulan" data-toggle="tooltip" id="idusulan" data="<?php echo $data->idusulan;?>"><i class="la la-trash"></i></a>
                                                                                <!--end::Button-->
                                                                            <?php }else{ ?>
                                                                                <!--begin::Button-->
                                                                                <span class='text-muted' style="font-size: 8pt">Tidak ada aksi</span>
                                                                                <!--end::Button-->
                                                                        <?php } }else{ ?>
                                                                            <!--begin::Button-->
                                                                            <span class='text-muted' style="font-size: 8pt">Tidak ada aksi</span>
                                                                            <!--end::Button-->
                                                                        <?php }?>
                                                                    </td>
                                                                </tr>
                                                                <?php endforeach; } ?>
                                                            </tbody>
                                                        </table>
                                                        <!--end: Datatable-->
                                                    </div>
<!--                                                    <div class="card-body">
                                                        begin: Search Form
                                                        begin::Search Form
                                                        <div class="mb-7">
                                                            <div class="row align-items-center">
                                                                <div class="col-lg-9 col-xl-8">
                                                                    <div class="row align-items-center">
                                                                        <div class="col-md-4 my-2 my-md-0">
                                                                            <div class="input-icon">
                                                                                <input type="text" class="form-control" placeholder="Masukkan kata kunci pencarian..." id="kt_datatable_search_query" />
                                                                                <span>
                                                                                    <i class="flaticon2-search-1 text-muted"></i>
                                                                                </span>
                                                                            </div>
                                                                        </div>
                                                                        <div class="col-md-4 my-2 my-md-0">
                                                                            <div class="d-flex align-items-center">
                                                                                <label class="mr-3 mb-0 d-none d-md-block">Skema:</label>
                                                                                <select class="form-control" id="kt_datatable_search_status">
                                                                                    <option value="">Semua Skema</option>
                                                                                    <?php foreach($skema as $data): ?>
                                                                                        <option value="<?php echo $data->idskema; ?>"><?php echo $data->namaskema; ?></option>
                                                                                    <?php endforeach; ?>
                                                                                </select>
                                                                            </div>
                                                                        </div>
                                                                        <div class="col-md-4 my-2 my-md-0">
                                                                            <div class="d-flex align-items-center">
                                                                                <label class="mr-3 mb-0 d-none d-md-block">Status:</label>
                                                                                <select class="form-control" id="kt_datatable_search_type">
                                                                                    <option value="">Semua Status</option>
                                                                                    <option value="1">Baru</option>
                                                                                    <option value="2">Final</option>
                                                                                    <option value="3">Didanai</option>
                                                                                    <option value="4">Ditolak</option>
                                                                                </select>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                                <div class="col-lg-3 col-xl-4 mt-5 mt-lg-0">
                                                                    <a href="#" class="btn btn-light-primary px-6 font-weight-bold">Search</a>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        end::Search Form
                                                        end: Search Form
                                                        begin: Datatable
                                                        <table class="datatable datatable-bordered datatable-head-custom" id="kt_datatable">
                                                            <thead>
                                                                <tr>
                                                                    <th title="Field #1" width="5%">No</th>
                                                                    <th title="Field #2" width="20%">Judul</th>
                                                                    <th title="Field #3" width="15%">Peneliti</th>
                                                                    <th title="Field #4" width="10%">Dana</th>
                                                                    <th title="Field #5" width="15%">Skema</th>
                                                                    <th title="Field #6" width="10%">Status</th>
                                                                    <th title="Field #7" width="5%">Proposal</th>
                                                                    <th title="Field #7" width="20%">Aksi</th>
                                                                </tr>
                                                            </thead>
                                                            <tbody>
                                                                <?php if($ppm != null){
                                                                        $i=1;
                                                                        foreach($ppm as $data):
                                                                ?>
                                                                <tr>
                                                                    <td  width="5%"><?php echo $i++; ?></td>
                                                                    <td  width="20%"><?php echo $data->judul; ?></td>
                                                                    <td width="15%">
                                                                        <?php 
                                                                        echo "<ol style='padding-left: 15px'>";
                                                                        echo "<li>".$data->gelardepan." ".$data->namalengkap.", ".$data->gelarblkg."</li>"; 
                                                                        $query = $this->db->query("SELECT * from usulananggota, peneliti where usulananggota.nipnim=peneliti.nipnim and idusulan='$data->idusulan' and posisi='Anggota'");
                                                                        if ($query->num_rows() > 0) {
                                                                            foreach ($query->result() as $row) { 
                                                                                echo "<li>".$row->gelardepan." ".$row->namalengkap.", ".$row->gelarblkg."</li>";
                                                                             }                                                                             
                                                                        } 
                                                                        echo "</ol>";
                                                                        ?>
                                                                    </td>
                                                                    <td  width="10%"><?php echo "Rp " . number_format($data->dana,2,',','.'); ?></td>
                                                                    <td>2016-11-28</td>
                                                                    <td class="text-right"  width="15%"><?php echo $data->idskema; ?></td>
                                                                    <td class="text-right"  width="10%">
                                                                        <?php if($data->statususulan=="Baru"){
                                                                            echo "1";
                                                                        }else if($data->statususulan=="Final"){
                                                                            echo "2";
                                                                        }else if($data->statususulan=="Didanai"){
                                                                            echo "3";
                                                                        }else if($data->statususulan=="Tidak Didanai"){
                                                                            echo "4";
                                                                        } ?>
                                                                    </td>
                                                                    <td  width="5%">
                                                                        <?php 
                                                                        $query = $this->db->query("SELECT * from usulanfile where idusulan='$data->idusulan' and idjenis in(select idjenis from jenisfile where namafile='Proposal')");
                                                                        if ($query->num_rows() > 0) {
                                                                            foreach ($query->result() as $row) { ?>
                                                                                    <a href="<?php echo base_url().$row->fileloc; ?>" target="_blank" title="Klik untuk melihat dokumen">
                                                                                        <img alt="" class="max-h-55px" src="<?php echo base_url() . 'dist/assets/media/svg/files/pdf.svg'?>"/>
                                                                                    </a>
                                                                                <?php   
                                                                             }
                                                                        }else{ ?>
                                                                        <i class="fa la-file-pdf icon-4x" title="Proposal belum diunggah"></i>
                                                                        <?php } ?>
                                                                        
                                                                    </td>
                                                                    <td width="20%">
                                                                        <?php if($data->statususulan=="Baru" or $data->statususulan=="Final"){ ?>
                                                                            begin::Button
                                                                            <a href="<?php echo base_url('index.php/c_usulan/editloadingpage/'.$data->idusulan) ?>" class="btn btn-warning font-weight-bolder">
                                                                                <span class="svg-icon svg-icon-md">begin::Svg Icon | path:C:\wamp64\www\keenthemes\legacy\metronic\theme\html\demo2\dist/../src/media/svg/icons\Communication\Write.svg<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="24px" height="24px" viewBox="0 0 24 24" version="1.1">
                                                                                    <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                                                                                        <rect x="0" y="0" width="24" height="24"/>
                                                                                        <path d="M12.2674799,18.2323597 L12.0084872,5.45852451 C12.0004303,5.06114792 12.1504154,4.6768183 12.4255037,4.38993949 L15.0030167,1.70195304 L17.5910752,4.40093695 C17.8599071,4.6812911 18.0095067,5.05499603 18.0083938,5.44341307 L17.9718262,18.2062508 C17.9694575,19.0329966 17.2985816,19.701953 16.4718324,19.701953 L13.7671717,19.701953 C12.9505952,19.701953 12.2840328,19.0487684 12.2674799,18.2323597 Z" fill="#000000" fill-rule="nonzero" transform="translate(14.701953, 10.701953) rotate(-135.000000) translate(-14.701953, -10.701953) "/>
                                                                                        <path d="M12.9,2 C13.4522847,2 13.9,2.44771525 13.9,3 C13.9,3.55228475 13.4522847,4 12.9,4 L6,4 C4.8954305,4 4,4.8954305 4,6 L4,18 C4,19.1045695 4.8954305,20 6,20 L18,20 C19.1045695,20 20,19.1045695 20,18 L20,13 C20,12.4477153 20.4477153,12 21,12 C21.5522847,12 22,12.4477153 22,13 L22,18 C22,20.209139 20.209139,22 18,22 L6,22 C3.790861,22 2,20.209139 2,18 L2,6 C2,3.790861 3.790861,2 6,2 L12.9,2 Z" fill="#000000" fill-rule="nonzero" opacity="0.3"/>
                                                                                    </g>
                                                                                </svg>end::Svg Icon</span>
                                                                                Perbarui</a>
                                                                            end::Button
                                                                        <?php }else{ ?>
                                                                            begin::Button
                                                                            <a href="javascript:;" class="btn btn-warning font-weight-bolder disabled">
                                                                                <span class="svg-icon svg-icon-md">begin::Svg Icon | path:C:\wamp64\www\keenthemes\legacy\metronic\theme\html\demo2\dist/../src/media/svg/icons\Communication\Write.svg<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="24px" height="24px" viewBox="0 0 24 24" version="1.1">
                                                                                    <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                                                                                        <rect x="0" y="0" width="24" height="24"/>
                                                                                        <path d="M12.2674799,18.2323597 L12.0084872,5.45852451 C12.0004303,5.06114792 12.1504154,4.6768183 12.4255037,4.38993949 L15.0030167,1.70195304 L17.5910752,4.40093695 C17.8599071,4.6812911 18.0095067,5.05499603 18.0083938,5.44341307 L17.9718262,18.2062508 C17.9694575,19.0329966 17.2985816,19.701953 16.4718324,19.701953 L13.7671717,19.701953 C12.9505952,19.701953 12.2840328,19.0487684 12.2674799,18.2323597 Z" fill="#000000" fill-rule="nonzero" transform="translate(14.701953, 10.701953) rotate(-135.000000) translate(-14.701953, -10.701953) "/>
                                                                                        <path d="M12.9,2 C13.4522847,2 13.9,2.44771525 13.9,3 C13.9,3.55228475 13.4522847,4 12.9,4 L6,4 C4.8954305,4 4,4.8954305 4,6 L4,18 C4,19.1045695 4.8954305,20 6,20 L18,20 C19.1045695,20 20,19.1045695 20,18 L20,13 C20,12.4477153 20.4477153,12 21,12 C21.5522847,12 22,12.4477153 22,13 L22,18 C22,20.209139 20.209139,22 18,22 L6,22 C3.790861,22 2,20.209139 2,18 L2,6 C2,3.790861 3.790861,2 6,2 L12.9,2 Z" fill="#000000" fill-rule="nonzero" opacity="0.3"/>
                                                                                    </g>
                                                                                </svg>end::Svg Icon</span>
                                                                                Perbarui</a>
                                                                            end::Button
                                                                        <?php } ?>
                                                                    </td>
                                                                </tr>
                                                                <?php endforeach; } ?>
                                                            </tbody>
                                                        </table>
                                                        end: Datatable
                                                    </div>-->
                                                </div>
                                                <!--end::Card-->
                                            </div>
                                        </div>
                                        <!--end::Row-->
                                        <!--end::Dashboard-->
                                    </div>
                                </div>
                            </div>
                            <!--end::Container-->
                        </div>
                        <!--end::Entry-->
                    </div>
                    <!--end::Content-->
                    <?php include 'v_footer.php'; ?>
                </div>
                <!--end::Wrapper-->
            </div>
            <!--end::Page-->
        </div>
        <!--end::Main-->
        <?php include 'v_panel.php'; ?>
        <!--begin::Scrolltop-->
        <div id="kt_scrolltop" class="scrolltop">
            <span class="svg-icon">
                <!--begin::Svg Icon | path:assets/media/svg/icons/Navigation/Up-2.svg-->
                <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="24px" height="24px" viewBox="0 0 24 24" version="1.1">
                <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                <polygon points="0 0 24 0 24 24 0 24" />
                <rect fill="#000000" opacity="0.3" x="11" y="10" width="2" height="10" rx="1" />
                <path d="M6.70710678,12.7071068 C6.31658249,13.0976311 5.68341751,13.0976311 5.29289322,12.7071068 C4.90236893,12.3165825 4.90236893,11.6834175 5.29289322,11.2928932 L11.2928932,5.29289322 C11.6714722,4.91431428 12.2810586,4.90106866 12.6757246,5.26284586 L18.6757246,10.7628459 C19.0828436,11.1360383 19.1103465,11.7686056 18.7371541,12.1757246 C18.3639617,12.5828436 17.7313944,12.6103465 17.3242754,12.2371541 L12.0300757,7.38413782 L6.70710678,12.7071068 Z" fill="#000000" fill-rule="nonzero" />
                </g>
                </svg>
                <!--end::Svg Icon-->
            </span>
        </div>
        <!--end::Scrolltop-->
        <script>var HOST_URL = "/metronic/theme/html/tools/preview";</script>
        <!--begin::Global Config(global config for global JS scripts)-->
        <script>var KTAppSettings = { "breakpoints": { "sm": 576, "md": 768, "lg": 992, "xl": 1200, "xxl": 1200 }, "colors": { "theme": { "base": { "white": "#ffffff", "primary": "#6993FF", "secondary": "#E5EAEE", "success": "#1BC5BD", "info": "#8950FC", "warning": "#FFA800", "danger": "#F64E60", "light": "#F3F6F9", "dark": "#212121" }, "light": { "white": "#ffffff", "primary": "#E1E9FF", "secondary": "#ECF0F3", "success": "#C9F7F5", "info": "#EEE5FF", "warning": "#FFF4DE", "danger": "#FFE2E5", "light": "#F3F6F9", "dark": "#D6D6E0" }, "inverse": { "white": "#ffffff", "primary": "#ffffff", "secondary": "#212121", "success": "#ffffff", "info": "#ffffff", "warning": "#ffffff", "danger": "#ffffff", "light": "#464E5F", "dark": "#ffffff" } }, "gray": { "gray-100": "#F3F6F9", "gray-200": "#ECF0F3", "gray-300": "#E5EAEE", "gray-400": "#D6D6E0", "gray-500": "#B5B5C3", "gray-600": "#80808F", "gray-700": "#464E5F", "gray-800": "#1B283F", "gray-900": "#212121" } }, "font-family": "Poppins" };</script>
        <!--end::Global Config-->
        <!--begin::Global Theme Bundle(used by all pages)-->
        <script src=<?php echo base_url() . "dist/assets/plugins/global/plugins.bundle.js?v=7.2.8" ?>></script>
        <script src=<?php echo base_url() . "dist/assets/plugins/custom/prismjs/prismjs.bundle.js?v=7.2.8" ?>></script>
        <script src=<?php echo base_url() . "dist/assets/js/scripts.bundle.js?v=7.2.8" ?>></script>
        <!--end::Global Theme Bundle-->
        <!--begin::Page Vendors(used by this page)-->
        <script src=<?php // echo base_url() . "dist/assets/plugins/custom/fullcalendar/fullcalendar.bundle.js?v=7.2.8" ?>></script>
        <script src=<?php echo base_url() . "dist/assets/plugins/custom/datatables/datatables.bundle.js" ?>></script>
        <!--end::Page Vendors-->
        <!--begin::Page Scripts(used by this page)-->
        <script src=<?php // echo base_url() . "dist/assets/js/pages/crud/ktdatatable/base/html-table-usulan.js" ?>></script>
        <!--end::Page Scripts-->
        <script type="text/javascript">
            var KTDatatablesDataSourceHtml = function() {

                    var initTable1 = function() {
                            var table = $('#kt_datatable');

                            // begin first table
                            table.DataTable({
                                    responsive: true,
                                    columnDefs: [
//                                            {
//                                                    targets: -1,
//                                                    title: 'Actions',
//                                                    orderable: false,
//                                                    render: function(data, type, full, meta) {
//                                                            return '\
//                                                                    <div class="dropdown dropdown-inline">\
//                                                                            <a href="javascript:;" class="btn btn-sm btn-clean btn-icon" data-toggle="dropdown">\
//                                                    <i class="la la-cog"></i>\
//                                                </a>\
//                                                                            <div class="dropdown-menu dropdown-menu-sm dropdown-menu-right">\
//                                                                                    <ul class="nav nav-hoverable flex-column">\
//                                                                                    <li class="nav-item"><a class="nav-link" href="#"><i class="nav-icon la la-edit"></i><span class="nav-text">Edit Details</span></a></li>\
//                                                                                    <li class="nav-item"><a class="nav-link" href="#"><i class="nav-icon la la-leaf"></i><span class="nav-text">Update Status</span></a></li>\
//                                                                                    <li class="nav-item"><a class="nav-link" href="#"><i class="nav-icon la la-print"></i><span class="nav-text">Print</span></a></li>\
//                                                                                    </ul>\
//                                                                            </div>\
//                                                                    </div>\
//                                                                    <a href="javascript:;" class="btn btn-sm btn-clean btn-icon" title="Edit details">\
//                                                                            <i class="la la-edit"></i>\
//                                                                    </a>\
//                                                                    <a href="javascript:;" class="btn btn-sm btn-clean btn-icon" title="Delete">\
//                                                                            <i class="la la-trash"></i>\
//                                                                    </a>\
//                                                            ';
//                                                    },
//                                            },
                                            {
                                                    targets: 6,
                                                    title: 'Proposal',
                                                    orderable: false,
                                            },
                                            {
                                                    targets: 7,
                                                    title: 'Aksi',
                                                    orderable: false,
                                            },
                                            {
                                                    width: '75px',
                                                    title: 'Usulan Dana',
                                                    targets: 3,
                                            },
                                            {
                                                    width: '75px',
                                                    title: 'Skema',
                                                    targets: 4,
                                                    render: function(data, type, full, meta) {
                                                            var status = {
                                                                <?php foreach($skema as $data): 
                                                                echo $data->idskema.": { 'title' : '".$data->namaskema."'},";
                                                                endforeach; ?>
//                                                                    1: {'title': 'Online', 'state': 'danger'},
//                                                                    2: {'title': 'Retail', 'state': 'primary'},
//                                                                    3: {'title': 'Direct', 'state': 'success'},
                                                            };
                                                            if (typeof status[data] === 'undefined') {
                                                                    return data;
                                                            }
                                                            return status[data].title;
//                                                            return '<span class="label label-' + status[data].state + ' label-dot mr-2"></span>' +
//                                                                    '<span class="font-weight-bold text-' + status[data].state + '">' + status[data].title + '</span>';
                                                    },
                                            },
                                            {
                                                    width: '75px',
                                                    title: 'Status',
                                                    targets: 5,
                                                    render: function(data, type, full, meta) {
                                                            var status = {
                                                                    1: {'title': 'Baru', 'class': ' label-light-warning'},
                                                                    2: {'title': 'Final', 'class': ' label-light-primary'},
                                                                    3: {'title': 'Didanai', 'class': ' label-light-success'},
                                                                    4: {'title': 'Ditolak', 'class': ' label-light-danger'},
                                                            };
                                                            if (typeof status[data] === 'undefined') {
                                                                    return data;
                                                            }
                                                            return '<span class="label label-lg font-weight-bold' + status[data].class + ' label-inline">' + status[data].title + '</span>';
                                                            
                                                    },
                                            },
                                    ],
                            });

                    };

                    return {

                            //main function to initiate the module
                            init: function() {
                                    initTable1();
                            },

                    };

            }();

            jQuery(document).ready(function() {
                    KTDatatablesDataSourceHtml.init();
            });
//            var KTDatatableHtmlTableDemo = function() {
//            // Private functions
//
//                // demo initializer
//                var demo = function() {
//                    var datatable = $('#kt_datatable').KTDatatable({
//                        AutoWidth: false,
//    //                    ],
//                        data: {
//                          saveState: {cookie: false},
//                        },
//                        search: {
//                          input: $('#kt_datatable_search_query'),
//                          key: 'generalSearch',
//                        },
//                        layout: {
//                          class: 'datatable-bordered',
//                        },
//                        columns: [
//    //                      {
//    //                        field: 'DepositPaid',
//    //                        type: 'number',
//    //                      },
//    //                      {
//    //                        field: 'OrderDate',
//    //                        type: 'date',
//    //                        format: 'YYYY-MM-DD',
//    //                      }, 
//                          {
//                            field: 'Skema',
//                            title: 'Skema',
//                            width: '50%',
//                            autoHide: false,
//                            // callback function support for column rendering
//                            template: function(row) {
//                              var status = {
//                                  <?php foreach($skema as $data): 
                                   echo $data->idskema.": { 'title' : '".$data->namaskema."'},";
                                   endforeach; ?>//
//                              };
//                              return status[row.Skema].title;
//    //                          return '<span class="label font-weight-bold label-lg' + status[row.Status].class + ' label-inline">' + status[row.Status].title + '</span>';
//                            },
//                          }, 
//                          {
//                            field: 'Status',
//                            title: 'Status',
//                            autoHide: false,
//                            // callback function support for column rendering
//                            template: function(row) {
//                              var status = {
//                                1: {
//                                  'title': 'Baru',
//                                  'class': ' label-light-warning',
//                                },
//                                2: {
//                                  'title': 'Final',
//                                  'class': ' label-light-primary',
//                                },
//                                3: {
//                                  'title': 'Didanai',
//                                  'class': ' label-light-success',
//                                },
//                                4: {
//                                  'title': 'Ditolak',
//                                  'class': ' label-light-danger',
//                                },
//                              };
//                              return '<span class="label font-weight-bold label-lg' + status[row.Status].class + ' label-inline">' + status[row.Status].title + '</span>';
//                            },
//                          }, 
//                        ],
//                      });
//
//                      $('#kt_datatable_search_status').on('change', function() {
//                        datatable.search($(this).val().toLowerCase(), 'Skema');
//                      });
//
//                      $('#kt_datatable_search_type').on('change', function() {
//                        datatable.search($(this).val().toLowerCase(), 'Status');
//                    });
//                    $('#kt_datatable_search_status, #kt_datatable_search_type').selectpicker();
//                };
//
//                return {
//                  // Public functions
//                  init: function() {
//                    // init dmeo
//                    demo();
//                  },
//                };
//            }();
//
//            jQuery(document).ready(function() {
//              KTDatatableHtmlTableDemo.init();
//            });
            
            $(document).ready(function(){
                $('body').on('change','#kt_datatable_search_skema', function() {
                    var fd = new FormData();
                    var id = this.value
                    
                    fd.append('id',id);
                    // AJAX request
                    $.ajax({
                        url: '<?php echo base_url('index.php/c_usulan/setskema') ?>',
                        type: 'post',
                        data: fd,
                        contentType: false,
                        processData: false,
                        success: function(response){
                            window.location='<?php echo base_url() . "index.php/c_usulan"; ?>';
                        }
                    });
                    e.preventDefault(); 
                });
                $('body').on('change','#kt_datatable_search_status', function() {
                    var fd = new FormData();
                    var id = this.value
                    
                    fd.append('id',id);
                    // AJAX request
                    $.ajax({
                        url: '<?php echo base_url('index.php/c_usulan/setstatus') ?>',
                        type: 'post',
                        data: fd,
                        contentType: false,
                        processData: false,
                        success: function(response){
                            window.location='<?php echo base_url() . "index.php/c_usulan"; ?>';
                        }
                    });
                    e.preventDefault(); 
                });
                $(document).on("click", ".usulanbaru", function() {
                    Swal.fire({
                        title: "Informasi Penting",
                        text: "Anda wajib mengisi Pengajuan Proposal Baru sampai denga Final. Apabila anda memiliki pengajuan proposal tertunda, halaman akan dialihkan ke Pengajuan Proposal sebelumnya. ",
                        icon: "warning",
                        showCancelButton: true,
                        confirmButtonText: "Mengerti, lanjutkan",
                        cancelButtonText: "Batalkan",
                        reverseButtons: true
//                        swal.fire({
//                            title: "Informasi",
//                            text: "Anda wajib mengisi Pengajuan Proposal Baru sampai denga Final. Apabila anda memiliki pengajuan proposal tertunda, halaman akan dialihkan ke Pengajuan Proposal sebelumnya. ",
//                            type: "warning",
//                            showCancelButton: true,
//                            confirmButtonText: "Hapus",
//                            closeOnConfirm: true,
                        }).then(function (result) {
				if (result.value) {
					window.location='<?php echo base_url() . "index.php/c_usulan/ajukanproposal"; ?>';
					// result.dismiss can be 'cancel', 'overlay',
					// 'close', and 'timer'
				} else if (result.dismiss === 'cancel') {
//					Swal.fire(
//						'Cancelled',
//						'Your imaginary file is safe :)',
//						'error'
//					)
				}
			});
                        
                    });
                    $(document).on("click", ".item_hapus", function() {
                    var id = $(this).attr('data');                   
                    Swal.fire({
                        title: "Hapus Usulan",
                        text: "Apakah anda yakin akan menghapus usulan penelitian/pengabdian ini ?",
                        icon: "warning",
                        showCancelButton: true,
                        confirmButtonText: "Ya, hapus",
                        cancelButtonText: "Tidak, batalkan",
                        reverseButtons: true
                    }).then(function (result) {
                            if (result.value) {
                                $.ajax({
                                    type: "POST",
                                    url: "<?php echo base_url() . "index.php/c_usulan/hapususulan"; ?>",
                                    dataType: "JSON",
                                    data: {id: id},
                                    success: function(response) {
                                        if(response != 0){
                                            $("tr[data-id='" + id + "']").fadeOut("fast", function() {
                                                $(this).remove();
                                            });
                                            Swal.fire(
                                                "Terhapus",
                                                "Usulan Penelitian/Pengabdian telah terhapus",
                                                "success"
                                            ).then(function() {
                                                    location.reload();
                                            });    
                                        }else{
                                            Swal.fire({title: "Oops...", text: "Usulan Penelitian/Pengabdian gagal dihapus. Usulan hanya bisa dihapus oleh Ketua Peneliti.", icon: "error",buttonsStyling:true, confirmButtonText: "OK"},
                                                function(){ 
                                                    location.reload();
                                                }
                                             );
                                        }    
                                    }
                                });
                            } else if (result.dismiss === 'cancel') {
                                Swal.fire(
                                        'Dibatalkan',
                                        'Aksi hapus dibatalkan.',
                                        'error'
                                )
                            }
                    });

                });
                    
            }); 
        </script>
    </body>
    <!--end::Body-->
</html>